<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#080b0f">
  <title>TankLog</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;500;700&family=Mulish:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pouchdb/8.0.1/pouchdb.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="app">

  <!-- â”€â”€ HEADER â”€â”€ -->
  <div id="header">
    <div id="header-left">
      <span class="logo">TANK<em>LOG</em></span>
    </div>
    <div id="header-center">
      <div class="vehicle-select-wrap" id="vehicle-select-wrap">
        <select id="vehicle-select" onchange="App.selectVehicle(this.value)">
          <option value="">â€” Fahrzeug wÃ¤hlen â€”</option>
        </select>
        <svg class="select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="6 9 12 15 18 9"/></svg>
      </div>
    </div>
    <div id="header-right">
      <button class="icon-btn" onclick="App.openGarage()" title="Garage">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      </button>
      <button class="icon-btn" onclick="App.openSettings()" title="Einstellungen">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
      </button>
    </div>
  </div>

  <!-- â”€â”€ SYNC STATUS BAR â”€â”€ -->
  <div id="sync-bar" class="sync-bar sync-offline">
    <span id="sync-dot" class="sync-dot"></span>
    <span id="sync-label">Offline â€” nur lokale Daten</span>
  </div>

  <!-- â”€â”€ CONTENT â”€â”€ -->
  <div id="content">

    <!-- VIEW: HOME -->
    <div class="view active" id="view-home">
      <div class="view-scroll">
        <div id="home-no-vehicle" class="empty-state" style="display:none">
          <div class="empty-icon">ðŸš—</div>
          <div class="empty-title">Kein Fahrzeug</div>
          <div class="empty-sub">Lege dein erstes Fahrzeug in der Garage an.</div>
          <button class="btn btn-primary" onclick="App.openGarage()">Garage Ã¶ffnen</button>
        </div>
        <div id="home-content">
          <div class="home-stats-grid" id="home-stats"></div>
          <div class="section-head">Letzter Tankvorgang</div>
          <div id="home-last-fuel" class="card"></div>
          <div class="section-head">Bald fÃ¤llig</div>
          <div id="home-upcoming"></div>
          <div class="section-head">Letzte EintrÃ¤ge</div>
          <div id="home-recent-list" class="card list-card"></div>
        </div>
      </div>
    </div>

    <!-- VIEW: LISTE -->
    <div class="view" id="view-list">
      <div class="view-scroll">
        <div class="list-toolbar">
          <div class="list-tabs">
            <button class="list-tab active" data-tab="fuel" onclick="App.switchListTab('fuel',this)">Tanken</button>
            <button class="list-tab" data-tab="maintenance" onclick="App.switchListTab('maintenance',this)">Wartung</button>
            <button class="list-tab" data-tab="costs" onclick="App.switchListTab('costs',this)">Kosten</button>
          </div>
          <button class="btn-add-row" id="list-add-btn" onclick="App.addFromList()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Neu
          </button>
        </div>
        <div id="list-content" class="card list-card"></div>
      </div>
    </div>

    <!-- VIEW: TANKEN (neuer Eintrag) -->
    <div class="view" id="view-tank">
      <div class="view-scroll">
        <div class="form-page-title">Neues <em>Tanken</em></div>

        <!-- OCR SCAN BUTTON -->
        <div class="ocr-trigger-row">
          <button class="ocr-trigger-btn" onclick="OCR.openOverlay()">
            <div class="ocr-trigger-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
                <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
                <circle cx="12" cy="13" r="4"/>
              </svg>
            </div>
            <div class="ocr-trigger-text">
              <span class="ocr-trigger-title">Tankzettel fotografieren</span>
              <span class="ocr-trigger-sub">OCR liest Datum, Liter &amp; Betrag automatisch</span>
            </div>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="color:var(--amber);flex-shrink:0"><polyline points="9 18 15 12 9 6"/></svg>
          </button>
        </div>

        <div class="ocr-divider"><span>oder manuell eingeben</span></div>

        <div class="form-section">
          <div class="form-row-2">
            <div class="form-group">
              <label>Datum</label>
              <input type="date" id="tf-date">
            </div>
            <div class="form-group">
              <label>km-Stand</label>
              <input type="number" id="tf-odometer" placeholder="123456" inputmode="numeric" oninput="App.updateFuelPreview()">
            </div>
          </div>
          <div class="form-row-2">
            <div class="form-group">
              <label>Liter</label>
              <input type="number" id="tf-liters" placeholder="45,21" step="0.01" inputmode="decimal" oninput="App.updateFuelPreview()">
            </div>
            <div class="form-group">
              <label>Gesamt â‚¬</label>
              <input type="number" id="tf-total" placeholder="53,30" step="0.01" inputmode="decimal" oninput="App.updateFuelPreview()">
            </div>
          </div>
          <div class="form-group">
            <label>Notiz (optional)</label>
            <input type="text" id="tf-note" placeholder="z.B. Shell A7">
          </div>
          <label class="checkbox-row">
            <input type="checkbox" id="tf-partial">
            <span class="checkbox-box"></span>
            <span>Nicht vollgetankt (Verbrauch aus Statistik ausschlieÃŸen)</span>
          </label>
        </div>

        <!-- Calc preview -->
        <div class="calc-preview-card" id="calc-preview" style="display:none">
          <div class="calc-item">
            <span class="calc-val" id="cp-ppl">â€”</span>
            <span class="calc-lbl">â‚¬/L</span>
          </div>
          <div class="calc-sep"></div>
          <div class="calc-item">
            <span class="calc-val" id="cp-km">â€”</span>
            <span class="calc-lbl">km gefahren</span>
          </div>
          <div class="calc-sep"></div>
          <div class="calc-item">
            <span class="calc-val" id="cp-cons">â€”</span>
            <span class="calc-lbl">L/100km</span>
          </div>
        </div>

        <div class="form-section">
          <div id="tf-validation-msg" class="validation-msg" style="display:none"></div>
          <button class="btn btn-primary btn-full" onclick="App.saveFuelEntry()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
            Tankvorgang speichern
          </button>
        </div>
      </div>
    </div>

    <!-- VIEW: ANALYSE -->
    <div class="view" id="view-analyse">
      <div class="view-scroll">
        <div class="analyse-period-bar">
          <button class="period-btn active" data-period="all" onclick="App.setAnalysePeriod('all',this)">Gesamt</button>
          <button class="period-btn" data-period="12" onclick="App.setAnalysePeriod('12',this)">12 Mo</button>
          <button class="period-btn" data-period="6" onclick="App.setAnalysePeriod('6',this)">6 Mo</button>
          <button class="period-btn" data-period="3" onclick="App.setAnalysePeriod('3',this)">3 Mo</button>
        </div>
        <div class="analyse-stats-grid" id="analyse-stats"></div>
        <div class="section-head">Verbrauch â€” L/100km</div>
        <div class="chart-card card"><canvas id="chart-consumption" height="180"></canvas></div>
        <div class="section-head">Kraftstoffpreis â€” â‚¬/L</div>
        <div class="chart-card card"><canvas id="chart-price" height="160"></canvas></div>
        <div class="section-head">Kosten gesamt â€” â‚¬/Monat</div>
        <div class="chart-card card"><canvas id="chart-costs" height="160"></canvas></div>
        <div class="section-head">Kosten nach Kategorie</div>
        <div id="costs-breakdown" class="card list-card"></div>
      </div>
    </div>

    <!-- VIEW: SYNC -->
    <div class="view" id="view-sync">
      <div class="view-scroll">
        <div class="form-page-title">Sync / <em>Backup</em></div>

        <!-- CouchDB Sync -->
        <div class="sync-section card">
          <div class="sync-section-head">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></svg>
            <span>CouchDB / NAS Sync</span>
            <span class="badge badge-amber" id="sync-badge">Aus</span>
          </div>
          <div class="sync-status-row" id="sync-status-detail">
            <span id="sync-detail-text">Nicht verbunden</span>
          </div>
          <div class="form-group" style="margin:12px 0 8px">
            <label>CouchDB URL</label>
            <input type="url" id="s-couchdb-url" placeholder="http://192.168.1.100:5984/tanklog">
          </div>
          <div class="form-row-2">
            <div class="form-group">
              <label>Benutzer</label>
              <input type="text" id="s-couchdb-user" placeholder="admin">
            </div>
            <div class="form-group">
              <label>Passwort</label>
              <input type="password" id="s-couchdb-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
            </div>
          </div>
          <div class="btn-row">
            <button class="btn btn-primary" id="sync-connect-btn" onclick="App.toggleSync()">Verbinden</button>
            <button class="btn btn-secondary" onclick="App.syncNow()">Jetzt sync</button>
          </div>
          <div class="sync-info-box">
            <strong>NAS Setup:</strong> CouchDB per Docker starten, CORS fÃ¼r deine IP aktivieren. Anleitung: <code>docker run -p 5984:5984 -e COUCHDB_USER=admin -e COUCHDB_PASSWORD=pass couchdb:3</code>
          </div>
        </div>

        <!-- Export/Import -->
        <div class="sync-section card">
          <div class="sync-section-head">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            <span>JSON Backup</span>
          </div>
          <div class="btn-row" style="flex-direction:column;gap:8px">
            <button class="btn btn-secondary btn-full" onclick="App.exportJSON()">ðŸ“¦ VollstÃ¤ndiges Backup exportieren</button>
            <button class="btn btn-secondary btn-full" onclick="App.downloadAllICS()">ðŸ“… Alle Termine als ICS exportieren</button>
            <label class="btn btn-secondary btn-full" style="cursor:pointer;justify-content:center">
              ðŸ“¥ Backup importieren (JSON)
              <input type="file" accept=".json" style="display:none" onchange="App.importJSON(this)">
            </label>
          </div>
        </div>

        <!-- CSV Import -->
        <div class="sync-section card">
          <div class="sync-section-head">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            <span>CSV Import (Google Sheets)</span>
          </div>
          <p style="font-size:12px;color:var(--t3);margin:6px 0 10px">Format: <code>datum,kmstand,liter,euro,notiz</code><br>Dezimalkomma, dd.mm.yyyy oder yyyy-mm-dd</p>
          <label class="btn btn-secondary btn-full" style="cursor:pointer;justify-content:center">
            ðŸ“Š CSV importieren
            <!-- Android/Google Drive: Datepicker filtert oft falsch â†’ Dateien werden "grau".
                 Daher kein enger accept-Filter. Wir prÃ¼fen/parse'n in JS. -->
            <input type="file" accept="*/*" style="display:none" onchange="App.importCSV(this)">
          </label>
          <div id="csv-result" style="margin-top:10px;display:none"></div>
        </div>

        <!-- Danger zone -->
        <div class="sync-section card" style="border-color:rgba(239,68,68,0.3)">
          <div class="sync-section-head" style="color:var(--red)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            Gefahrenzone
          </div>
          <button class="btn btn-danger btn-full" onclick="App.clearAllData()">Alle lokalen Daten lÃ¶schen</button>
        </div>

      </div>
    </div>

  </div><!-- /content -->

  <!-- â”€â”€ BOTTOM NAV â”€â”€ -->
  <nav id="nav">
    <button class="nav-btn active" id="nb-home" onclick="App.go('home')">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      Home
    </button>
    <button class="nav-btn" id="nb-list" onclick="App.go('list')">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
      Liste
    </button>
    <button class="nav-btn nav-center" id="nb-tank" onclick="App.go('tank')">
      <div class="nav-center-ring">
        <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      </div>
      Tanken
    </button>
    <button class="nav-btn" id="nb-analyse" onclick="App.go('analyse')">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      Analyse
    </button>
    <button class="nav-btn" id="nb-sync" onclick="App.go('sync')">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></svg>
      Sync
    </button>
  </nav>

</div><!-- /app -->

<!-- â”€â”€ TOAST â”€â”€ -->
<div id="toast"></div>

<!-- â”€â”€ OVERLAYS / MODALS â”€â”€ -->

<!-- Garage Overlay -->
<div class="overlay" id="overlay-garage">
  <div class="overlay-panel overlay-full">
    <div class="overlay-head">
      <span>Garage</span>
      <button class="icon-btn" onclick="App.closeOverlay('overlay-garage')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="overlay-body">
      <div id="garage-list"></div>
      <button class="btn btn-primary btn-full" style="margin-top:12px" onclick="App.openVehicleForm()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Fahrzeug hinzufÃ¼gen
      </button>
    </div>
  </div>
</div>

<!-- Vehicle Form Overlay -->
<div class="overlay" id="overlay-vehicle-form">
  <div class="overlay-panel overlay-sheet">
    <div class="overlay-head">
      <span id="vehicle-form-title">Fahrzeug anlegen</span>
      <button class="icon-btn" onclick="App.closeOverlay('overlay-vehicle-form')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="overlay-body">
      <input type="hidden" id="vf-id">

      <!-- VEHICLE DATABASE PICKER -->
      <div class="vdb-picker-card" id="vdb-picker-card">
        <div class="vdb-picker-head">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
          <span>Fahrzeug aus Datenbank wÃ¤hlen</span>
          <button class="vdb-collapse-btn" id="vdb-collapse-btn" onclick="App.toggleVdbPicker()">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="18 15 12 9 6 15"/></svg>
          </button>
        </div>
        <div id="vdb-picker-body">
          <div class="vdb-cascade">
            <div class="form-group">
              <label>Marke</label>
              <select id="vdb-brand" onchange="App.vdbSelectBrand(this.value)">
                <option value="">â€” Marke wÃ¤hlen â€”</option>
              </select>
            </div>
            <div class="form-group" id="vdb-model-group" style="display:none">
              <label>Modell</label>
              <select id="vdb-model" onchange="App.vdbSelectModel(this.value)">
                <option value="">â€” Modell wÃ¤hlen â€”</option>
              </select>
            </div>
            <div class="form-group" id="vdb-gen-group" style="display:none">
              <label>Generation / Baujahr</label>
              <select id="vdb-generation" onchange="App.vdbSelectGeneration(this.value)">
                <option value="">â€” Generation wÃ¤hlen â€”</option>
              </select>
            </div>
            <div class="form-group" id="vdb-variant-group" style="display:none">
              <label>Motorvariante</label>
              <select id="vdb-variant" onchange="App.vdbSelectVariant(this.value)">
                <option value="">â€” Variante wÃ¤hlen â€”</option>
              </select>
            </div>
            <div id="vdb-tire-group" style="display:none">
              <div class="form-group">
                <label>ReifengrÃ¶ÃŸe wÃ¤hlen</label>
                <div id="vdb-tire-chips" class="chip-row"></div>
              </div>
            </div>
          </div>
          <div id="vdb-preview" class="vdb-preview" style="display:none"></div>
          <button class="btn btn-primary btn-full" id="vdb-apply-btn" onclick="App.vdbApply()" style="display:none;margin-top:8px">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
            Daten Ã¼bernehmen
          </button>
        </div>
      </div>

      <div class="form-section-label" style="margin-top:14px">Fahrzeugdaten</div>

      <div class="form-row-2">
        <div class="form-group">
          <label>Name (Kurzname) *</label>
          <input type="text" id="vf-name" placeholder="Golf">
        </div>
        <div class="form-group">
          <label>Kraftstoff *</label>
          <select id="vf-fueltype"></select>
        </div>
      </div>
      <div class="form-row-2">
        <div class="form-group">
          <label>Marke</label>
          <input type="text" id="vf-make" placeholder="Volkswagen">
        </div>
        <div class="form-group">
          <label>Modell</label>
          <input type="text" id="vf-model" placeholder="Golf">
        </div>
      </div>
      <div class="form-section-label">Details</div>
      <div class="form-row-2">
        <div class="form-group">
          <label>Baujahr</label>
          <input type="number" id="vf-year" placeholder="2015" min="1900" max="2100">
        </div>
        <div class="form-group">
          <label>Variante</label>
          <input type="text" id="vf-variant" placeholder="Golf VI 5K">
        </div>
      </div>
      <div class="form-row-2">
        <div class="form-group">
          <label>Kennzeichen</label>
          <input type="text" id="vf-plate" placeholder="MÃœN-AB 123" oninput="App.updatePlatePreview(this.value)">
        </div>
        <div class="form-group">
          <label>Motorcode</label>
          <input type="text" id="vf-engine" placeholder="CBZB">
        </div>
      </div>

      <!-- LIVE KENNZEICHEN PREVIEW -->
      <div id="plate-preview-wrap" style="display:flex;justify-content:center;padding:10px 0 4px">
        <div class="plate-preview" id="plate-preview">
          <div class="plate-eu-strip">
            <div class="plate-eu-stars">â˜…</div>
            <div class="plate-eu-d">D</div>
          </div>
          <div class="plate-text" id="plate-text">XXÂ·AB 123</div>
          <div class="plate-sticker-wrap">
            <div class="plate-sticker-tl"></div>
            <div class="plate-sticker-tr"></div>
          </div>
        </div>
      </div>

      <div class="form-row-2">
        <div class="form-group">
          <label>ReifengrÃ¶ÃŸe</label>
          <input type="text" id="vf-tires" placeholder="205/55 R16">
        </div>
        <div class="form-group">
          <label>Ã–l-Spezifikation</label>
          <input type="text" id="vf-oil" placeholder="5W-30">
        </div>
      </div>
      <div class="form-group">
        <label>VIN / Fahrgestellnummer</label>
        <input type="text" id="vf-vin" placeholder="WVWZZZ1JZ3W386752">
      </div>
      <div class="form-group">
        <label>Notizen</label>
        <textarea id="vf-notes" rows="3" placeholder="Weitere Infosâ€¦" style="width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:10px 12px;color:var(--t1);font-family:var(--font-body);font-size:14px;resize:none;outline:none"></textarea>
      </div>
      <div class="btn-row" style="margin-top:8px">
        <button class="btn btn-secondary" id="vf-delete-btn" onclick="App.deleteVehicle()" style="display:none">LÃ¶schen</button>
        <button class="btn btn-primary" style="flex:1" onclick="App.saveVehicle()">Speichern</button>
      </div>
    </div>
  </div>
</div>

<!-- Fuel Edit Overlay -->
<div class="overlay" id="overlay-fuel-edit">
  <div class="overlay-panel overlay-sheet">
    <div class="overlay-head">
      <span id="fuel-edit-title">Tankvorgang</span>
      <button class="icon-btn" onclick="App.closeOverlay('overlay-fuel-edit')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="overlay-body">
      <input type="hidden" id="fe-id">
      <div class="form-row-2">
        <div class="form-group"><label>Datum</label><input type="date" id="fe-date"></div>
        <div class="form-group"><label>km-Stand</label><input type="number" id="fe-odometer" inputmode="numeric"></div>
      </div>
      <div class="form-row-2">
        <div class="form-group"><label>Liter</label><input type="number" id="fe-liters" step="0.01" inputmode="decimal"></div>
        <div class="form-group"><label>Gesamt â‚¬</label><input type="number" id="fe-total" step="0.01" inputmode="decimal"></div>
      </div>
      <div class="form-group"><label>Notiz</label><input type="text" id="fe-note"></div>
      <label class="checkbox-row"><input type="checkbox" id="fe-partial"><span class="checkbox-box"></span><span>Nicht vollgetankt</span></label>
      <div class="btn-row" style="margin-top:12px">
        <button class="btn btn-danger" onclick="App.deleteFuelEntry()">LÃ¶schen</button>
        <button class="btn btn-primary" style="flex:1" onclick="App.saveFuelEdit()">Speichern</button>
      </div>
    </div>
  </div>
</div>

<!-- Maintenance Form Overlay -->
<div class="overlay" id="overlay-maint-form">
  <div class="overlay-panel overlay-sheet">
    <div class="overlay-head">
      <span id="maint-form-title">Wartung</span>
      <button class="icon-btn" onclick="App.closeOverlay('overlay-maint-form')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="overlay-body">
      <input type="hidden" id="mf-id">
      <div class="form-group"><label>Titel *</label><input type="text" id="mf-title" placeholder="TÃœV, Ã–lwechsel, â€¦" list="maint-titles-list"><datalist id="maint-titles-list"><option value="TÃœV"/><option value="Ã–lwechsel"/><option value="Inspektion"/><option value="Reifenwechsel"/><option value="Sonstiges"/></datalist></div>
      <div class="form-row-2">
        <div class="form-group"><label>Datum (durchgefÃ¼hrt)</label><input type="date" id="mf-date"></div>
        <div class="form-group"><label>km-Stand</label><input type="number" id="mf-odometer" inputmode="numeric"></div>
      </div>
      <div class="form-group"><label>Kosten (â‚¬)</label><input type="number" id="mf-cost" step="0.01" inputmode="decimal"></div>
      <div class="form-section-label">FÃ¤lligkeit</div>
      <div class="form-row-2">
        <div class="form-group"><label>FÃ¤llig am</label><input type="date" id="mf-due-date"></div>
        <div class="form-group"><label>FÃ¤llig bei km</label><input type="number" id="mf-due-km" inputmode="numeric"></div>
      </div>
      <div class="form-row-2">
        <div class="form-group"><label>Erinnerung (Tage vorher)</label><input type="number" id="mf-remind-days" placeholder="30" inputmode="numeric"></div>
        <div class="form-group"><label>Erinnerung (km vorher)</label><input type="number" id="mf-remind-km" inputmode="numeric"></div>
      </div>
      <div class="form-group"><label>Notiz</label><textarea id="mf-note" rows="2" style="width:100%;background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:10px 12px;color:var(--t1);font-family:var(--font-body);font-size:14px;resize:none;outline:none"></textarea></div>
      <div class="btn-row" style="margin-top:8px">
        <button class="btn btn-secondary" id="mf-ics-btn" onclick="App.downloadMaintICS()" style="display:none">ðŸ“… ICS</button>
        <button class="btn btn-danger" id="mf-delete-btn" onclick="App.deleteMaint()" style="display:none">LÃ¶schen</button>
        <button class="btn btn-primary" style="flex:1" onclick="App.saveMaint()">Speichern</button>
      </div>
    </div>
  </div>
</div>

<!-- Cost Form Overlay -->
<div class="overlay" id="overlay-cost-form">
  <div class="overlay-panel overlay-sheet">
    <div class="overlay-head">
      <span id="cost-form-title">Kosten</span>
      <button class="icon-btn" onclick="App.closeOverlay('overlay-cost-form')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="overlay-body">
      <input type="hidden" id="cf-id">
      <div class="form-row-2">
        <div class="form-group"><label>Datum *</label><input type="date" id="cf-date"></div>
        <div class="form-group"><label>Betrag â‚¬ *</label><input type="number" id="cf-amount" step="0.01" inputmode="decimal"></div>
      </div>
      <div class="form-group"><label>Kategorie</label><select id="cf-category"></select></div>
      <div class="form-group"><label>km-Stand</label><input type="number" id="cf-odometer" inputmode="numeric"></div>
      <div class="form-group"><label>Notiz</label><input type="text" id="cf-note" placeholder="Werkstatt MÃ¼ller, Reparaturâ€¦"></div>
      <div class="btn-row" style="margin-top:12px">
        <button class="btn btn-danger" id="cf-delete-btn" onclick="App.deleteCost()" style="display:none">LÃ¶schen</button>
        <button class="btn btn-primary" style="flex:1" onclick="App.saveCost()">Speichern</button>
      </div>
    </div>
  </div>
</div>

<!-- Settings Overlay -->
<div class="overlay" id="overlay-settings">
  <div class="overlay-panel overlay-sheet">
    <div class="overlay-head">
      <span>Einstellungen</span>
      <button class="icon-btn" onclick="App.closeOverlay('overlay-settings')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="overlay-body">
      <div class="form-section-label">Warnungen</div>
      <div class="form-group">
        <label>Warnung bei Verbrauch Ã¼ber (L/100km)</label>
        <input type="number" id="set-warn-consumption" placeholder="25" step="0.5" inputmode="decimal">
      </div>
      <div class="form-group">
        <label>Wartungs-Erinnerung (Tage)</label>
        <input type="number" id="set-remind-days" placeholder="14" inputmode="numeric">
      </div>
      <button class="btn btn-primary btn-full" onclick="App.saveSettings()" style="margin-top:12px">Speichern</button>
    </div>
  </div>
</div>

<!-- CSV Import Result Overlay -->
<div class="overlay" id="overlay-csv-result">
  <div class="overlay-panel overlay-sheet">
    <div class="overlay-head">
      <span>CSV Import Ergebnis</span>
      <button class="icon-btn" onclick="App.closeOverlay('overlay-csv-result')">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="overlay-body" id="csv-result-body"></div>
  </div>
</div>

<!-- OCR Overlay -->
<div class="overlay" id="overlay-ocr">
  <div class="overlay-panel overlay-sheet">
    <div class="overlay-head">
      <span>Tankzettel <em style="font-style:normal;color:var(--amber)">scannen</em></span>
      <button class="icon-btn" onclick="OCR.closeOverlay()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="overlay-body">

      <!-- Upload zone -->
      <div class="ocr-zone" id="ocr-zone">
        <!-- Zwei Inputs, weil Android/Samsung oft nur eins von beidem zuverlÃ¤ssig anbietet:
             - mit capture: Ã¶ffnet Kamera
             - ohne capture: Ã¶ffnet Galerie/Dateien -->
        <input type="file" id="ocr-file-camera" accept="image/*" capture="environment" style="display:none"
               onchange="OCR.handleFile(this.files[0])">
        <input type="file" id="ocr-file-gallery" accept="image/*" style="display:none"
               onchange="OCR.handleFile(this.files[0])">
        <svg width="44" height="44" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="color:var(--amber);margin-bottom:10px">
          <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
          <circle cx="12" cy="13" r="4"/>
        </svg>
        <p style="font-family:var(--font-head);font-size:16px;font-weight:700;letter-spacing:0.5px;color:var(--t1);margin-bottom:4px">Foto aufnehmen oder wÃ¤hlen</p>
        <p style="font-family:var(--font-mono);font-size:11px;color:var(--t3)">Tankzettel Â· kein Cloud-Upload Â· 100% lokal</p>
        <div class="btn-row" style="margin-top:10px;gap:10px">
          <button class="btn btn-primary" style="flex:1" onclick="document.getElementById('ocr-file-camera').click()">Kamera</button>
          <button class="btn btn-secondary" style="flex:1" onclick="document.getElementById('ocr-file-gallery').click()">Galerie/Dateien</button>
        </div>
      </div>

      <!-- Image preview -->
      <div id="ocr-img-preview-wrap" style="display:none;margin-bottom:10px">
        <img id="ocr-img-preview" style="width:100%;border-radius:10px;max-height:220px;object-fit:contain;border:1px solid var(--border)">
        <button class="btn btn-secondary" style="width:100%;margin-top:8px;font-size:12px" onclick="OCR.openOverlay()">
          Anderes Foto wÃ¤hlen
        </button>
      </div>

      <!-- Progress -->
      <div id="ocr-progress-wrap" style="display:none;margin:10px 0">
        <div style="background:var(--border);height:3px;border-radius:2px;overflow:hidden;margin-bottom:8px">
          <div id="ocr-progress-fill" style="height:100%;background:var(--amber);width:0%;transition:width 0.3s;border-radius:2px"></div>
        </div>
        <div id="ocr-progress-label" style="font-family:var(--font-mono);font-size:11px;color:var(--t3);text-align:center;letter-spacing:0.5px"></div>
      </div>

      <!-- OCR Results -->
      <div id="ocr-result-section" style="display:none">
        <div style="font-family:var(--font-head);font-size:12px;letter-spacing:1.5px;text-transform:uppercase;color:var(--t3);margin:12px 0 8px">Erkannte Werte â€” bitte prÃ¼fen</div>

        <div class="form-row-2">
          <div class="form-group">
            <label>Datum</label>
            <input type="date" id="ocr-r-date" class="ocr-field">
            <div class="ocr-hint" id="ocr-r-date-hint">âš  Unsicher â€” bitte prÃ¼fen</div>
          </div>
          <div class="form-group">
            <label>Liter</label>
            <input type="number" id="ocr-r-liters" step="0.01" class="ocr-field" inputmode="decimal">
            <div class="ocr-hint" id="ocr-r-liters-hint">âš  Unsicher â€” bitte prÃ¼fen</div>
          </div>
        </div>
        <div class="form-row-2">
          <div class="form-group">
            <label>Betrag â‚¬</label>
            <input type="number" id="ocr-r-total" step="0.01" class="ocr-field" inputmode="decimal">
            <div class="ocr-hint" id="ocr-r-total-hint">âš  Unsicher â€” bitte prÃ¼fen</div>
          </div>
          <div class="form-group">
            <label>â‚¬/Liter (optional)</label>
            <input type="number" id="ocr-r-ppl" step="0.001" class="ocr-field" inputmode="decimal">
            <div class="ocr-hint" id="ocr-r-ppl-hint">âš  Unsicher â€” bitte prÃ¼fen</div>
          </div>
        </div>

        <div class="btn-row" style="margin-top:4px">
          <button class="btn btn-secondary" onclick="OCR.openOverlay()">Nochmal</button>
          <button class="btn btn-primary" style="flex:1" onclick="OCR.transfer()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>
            Ins Formular Ã¼bernehmen
          </button>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Cache-Busting fÃ¼r GitHub Pages / Samsung Chrome -->
<script src="db.js?v=20260227"></script>
<script src="calc.js?v=20260227"></script>
<script src="vehicles.js?v=20260227"></script>
<script src="ocr.js?v=20260227"></script>
<script src="sync.js?v=20260227"></script>
<script src="app.js?v=20260227"></script>
</body>
</html>
